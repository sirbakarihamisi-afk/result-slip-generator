<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>STUDENT ACADEMIC REPORT</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>
:root {
  --school-primary:#2a5eec;
  --school-secondary:#e6f2f7;
}

body {
  font-family: Arial, Helvetica, sans-serif;
  background:#f0f2f5;
  padding:20px;
}

.container {
  max-width:950px;
  margin:auto;
  background:#fff;
  padding:25px;
  border-radius:6px;
}

h1 {
  text-align:center;
  color:var(--school-primary);
  margin-bottom:15px;
}

.controls {
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin-bottom:20px;
}

select,input,button {
  padding:8px;
  font-size:14px;
}

.slip {
  border:2px solid var(--school-primary);
  padding:20px;
  display:none;
  position:relative;
  overflow:hidden;
}

/* WATERMARK */
.slip::before{
  content:"";
  position:absolute;
  top:55%;
  left:50%;
  width:600px;
  height:600px;
  background:url("watermark.png") no-repeat center;
  background-size:contain;
  opacity:0.07;
  transform:translate(-50%,-50%);
  pointer-events:none;
}

.slip>*{position:relative;z-index:1;}

.report-header{
  display:grid;
  grid-template-columns:150px 1fr 120px;
  align-items:center;
  border-bottom:2px solid var(--school-primary);
  padding-bottom:10px;
  margin-bottom:15px;
}

.logo img{width:140px;}
.photo img{
  width:100px;height:120px;object-fit:cover;border:1px solid #ccc;
}

.school-title{text-align:center;font-weight:bold;}
.school-name{font-size:15px;}
.school-address{font-size:13px;}
.academic-meta{font-size:12px;font-weight:normal;}

.student-info{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:8px 20px;
  margin-bottom:15px;
}

table{
  width:100%;
  border-collapse:collapse;
  font-size:13px;
}

th,td{
  border:1px solid #000;
  padding:6px;
  text-align:center;
}

th{background:var(--school-secondary);}

.summary{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:10px;
  margin-top:15px;
}

.comment-box{
  border:1px solid #000;
  padding:10px;
  min-height:40px;
}

#teacherComment{
  color:#2a5eec;
  font-family:"Comic Sans MS","Comic Sans",cursive;
}

.signature img{height:60px;margin-top:10px;}

.footer-note{
  margin-top:20px;
  text-align:center;
  font-size:12px;
  font-style:italic;
}

.actions{text-align:center;margin-top:15px;}

@media print{
  .controls,.actions{display:none;}
}
</style>
</head>

<body>

<div class="container">
<h1>END TERM 1 – RESULT SLIP</h1>

<div class="controls">
<input type="file" id="fileInput" accept=".xlsx,.xls">
<select id="classSelect"><option value="">SELECT CLASS</option></select>
<select id="studentSelect"><option value="">SELECT STUDENT</option></select>
</div>

<div class="slip" id="slip">

<div class="report-header">
<div class="logo"><img src="logo.png"></div>
<div class="school-title">
STUDENT ACADEMIC REPORT<br>
<span class="school-name">TRANSCEND INTERNATIONAL SCHOOL</span><br>
<span class="school-address">ADDIS ABABA</span><br>
<span class="academic-meta">ACADEMIC YEAR: 2025–2026 | TERM 1</span>
</div>
<div class="photo"><img id="studentPhoto" src="default_photo.png"></div>
</div>

<div class="student-info">
<div><strong>CLASS:</strong> <span id="className"></span></div>
<div><strong>STUDENT:</strong> <span id="studentName"></span></div>
<div><strong>PARENT:</strong> <span id="parentName"></span></div>
<div><strong>OVERALL GRADE:</strong> <span id="finalGrade"></span></div>
</div>

<table>
<thead>
<tr>
<th>SUBJECT</th><th>TEACHER</th>
<th>BASELINE</th><th>GRADE</th>
<th>END</th><th>GRADE</th>
</tr>
</thead>
<tbody id="marksTable"></tbody>
</table>

<div class="summary">
<div><strong>TOTAL (BASELINE):</strong> <span id="totalBaseline"></span></div>
<div><strong>AVERAGE (BASELINE):</strong> <span id="avgBaseline"></span></div>
<div><strong>TOTAL (END):</strong> <span id="totalEnd"></span></div>
<div><strong>AVERAGE (END):</strong> <span id="avgEnd"></span></div>
</div>

<div style="margin-top:20px">
<strong>HOMEROOM TEACHER'S COMMENT</strong>
<div class="comment-box" id="teacherComment"></div>

<strong style="margin-top:10px;display:block">HEAD TEACHER</strong>
<div class="signature">
<img src="head_teacher_signature.png">
</div>
</div>

<div class="footer-note">
This report is unofficial unless signed and/or stamped by a school official.
</div>

<div class="actions">
<button onclick="window.print()">PRINT / SAVE PDF</button>
</div>

</div>
</div>

<script>
const SUBJECTS=[
"MAT","ENG","SCI","GC","COMP","AMHARIC","ARABIC","LIFESKILLS","PE"
];

let workbookData={},headers=[];

const grade=m=>{
if(m>=85)return"A*";if(m>=75)return"A";
if(m>=60)return"B";if(m>=40)return"C";
if(m>=30)return"D";if(m>=25)return"E";return"-";
};

fileInput.onchange=e=>{
const r=new FileReader();
r.onload=ev=>{
const wb=XLSX.read(new Uint8Array(ev.target.result),{type:"array"});
classSelect.innerHTML='<option value="">SELECT CLASS</option>';
workbookData={};

wb.SheetNames.forEach(n=>{
const rows=XLSX.utils.sheet_to_json(wb.Sheets[n],{header:1,range:5,defval:""});
headers=rows[0];
workbookData[n]=rows.slice(1).filter(r=>r.join(""));
classSelect.innerHTML+=`<option>${n}</option>`;
});
};
r.readAsArrayBuffer(e.target.files[0]);
};

classSelect.onchange=()=>{
studentSelect.innerHTML='<option value="">SELECT STUDENT</option>';
(workbookData[classSelect.value]||[]).forEach((r,i)=>{
const n=r[headers.indexOf("NAME OF STUDENT")];
if(n)studentSelect.innerHTML+=`<option value="${i}">${n}</option>`;
});
};

studentSelect.onchange=()=>{
const r=workbookData[classSelect.value][studentSelect.value];
if(!r)return;
slip.style.display="block";

className.textContent=classSelect.value;
studentName.textContent=r[headers.indexOf("NAME OF STUDENT")];
parentName.textContent=r[headers.indexOf("PARENT")];
teacherComment.textContent=r[headers.indexOf("TEACHERS COMMENT")];

const p=r[headers.indexOf("PHOTO")];
studentPhoto.src=p||"default_photo.png";
studentPhoto.onerror=()=>studentPhoto.src="default_photo.png";

marksTable.innerHTML="";
let bT=0,eT=0,bC=0,eC=0;

SUBJECTS.forEach(s=>{
const b=r[headers.indexOf(`${s} BASELINE`)];
const e=r[headers.indexOf(`${s} END`)];

if(b!==""){bT+=Number(b);bC++;}
if(e!==""){eT+=Number(e);eC++;}

marksTable.innerHTML+=`
<tr>
<td>${s}</td><td></td>
<td>${b!==""?b:"-"}</td><td>${b!==""?grade(b):"-"}</td>
<td>${e!==""?e:"-"}</td><td>${e!==""?grade(e):"-"}</td>
</tr>`;
});

totalBaseline.textContent=bT.toFixed(2);
avgBaseline.textContent=(bC?bT/bC:0).toFixed(2);
totalEnd.textContent=eT.toFixed(2);
avgEnd.textContent=(eC?eT/eC:0).toFixed(2);
finalGrade.textContent=grade(eC?eT/eC:0);
};
</script>

</body>
</html>
